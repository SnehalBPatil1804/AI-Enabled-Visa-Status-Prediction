# -*- coding: utf-8 -*-
"""PreProcessing.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1sDOVX4p0rV5qduqhwlLH84X3v6glaJED
"""

import pandas as pd
import numpy as np
from sklearn.preprocessing import LabelEncoder

# 1. Load the Genuine Dataset
file_path = 'LCA_Disclosure_Data_FY2026_Q1.xlsx'
try:
    df = pd.read_excel(file_path)
    print("Dataset loaded successfully!")
except FileNotFoundError:
    print("Error: Please upload 'LCA_Disclosure_Data_FY2026_Q1.xlsx' to your Colab folder.")

# 2. Generate Target Labels (Processing time in days)
df['RECEIVED_DATE'] = pd.to_datetime(df['RECEIVED_DATE'])
df['DECISION_DATE'] = pd.to_datetime(df['DECISION_DATE'])
df['Processing_Time_Days'] = (df['DECISION_DATE'] - df['RECEIVED_DATE']).dt.days

# 3. Handle Missing Values
# Fill categorical missing values with the most frequent (mode)
df['EMPLOYER_STATE'] = df['EMPLOYER_STATE'].fillna(df['EMPLOYER_STATE'].mode()[0])
# Clean and convert wage column to numeric
df['WAGE_RATE_OF_PAY_FROM'] = pd.to_numeric(df['WAGE_RATE_OF_PAY_FROM'].replace(r'[\$,]', '', regex=True), errors='coerce')
df['WAGE_RATE_OF_PAY_FROM'] = df['WAGE_RATE_OF_PAY_FROM'].fillna(df['WAGE_RATE_OF_PAY_FROM'].median())

# 4. Categorical Encoding
# Converting text columns into numbers for the AI model
le = LabelEncoder()
categorical_cols = ['CASE_STATUS', 'VISA_CLASS', 'EMPLOYER_STATE', 'SOC_TITLE']
for col in categorical_cols:
    df[col] = le.fit_transform(df[col].astype(str))

# 5. Save the Structured/Cleaned Dataset
df.to_csv('cleaned_visa_data.csv', index=False)
print("Milestone 1 Complete: 'cleaned_visa_data.csv' created.")

# Install Git LFS
!curl -s https://packagecloud.io/install/repositories/github/git-lfs/script.deb.sh | sudo bash
!sudo apt-get install git-lfs
!git lfs install

# 1. Configuration (Using your Token and Repo Name)
GITHUB_USER = "SnehalBPatil1804"
GITHUB_TOKEN = "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"
GITHUB_REPO = "AI-Enabled-Visa-Status-Prediction"
REPO_URL = f"https://{GITHUB_USER}:{GITHUB_TOKEN}@github.com/{GITHUB_USER}/{GITHUB_REPO}.git"

# 2. Reset the remote URL
!git remote set-url origin {REPO_URL}

# 3. Add and Commit
!git LICENSE README.md cleaned_visa_data.csv LCA_Disclosure_Data_FY2026_Q1.xlsx
# If you get "nothing to commit", it means your last commit is still ready to go
!git commit -m "Milestone 1: Force push to sync remote and local"

# 4. Force Push to the main branch (The -f flag is the fix)
!git push -f origin main

